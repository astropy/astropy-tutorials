<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" /><meta content="filterTutorials, filterModeling, filterModelFitting, filterAstrostatistics, filterAstroquery, filterVizier, filterScipy, filterMatplotlib, filterErrorBars, filterScatterPlots" name="keywords" />
<meta content="filterTutorials," name="keywords" />

    <title>Modeling 1: Make a quick fit using astropy.modeling &#8212; astropy-tutorials v3.0.dev</title>
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap_sandstone.css" />
    <link rel="stylesheet" type="text/css" href="../_static/astropy.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script src="../_static/js/jquery-1.11.0.min.js"></script>
    <script src="../_static/js/jquery-fix.js"></script>
    <script src="../_static/bootstrap-3.3.7/js/bootstrap.min.js"></script>
    <script src="../_static/bootstrap-sphinx.js"></script>
    <script src="../_static/searchtools.js"></script>
    <script src="https://use.fontawesome.com/3168e95f94.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
    <link rel="shortcut icon" href="../_static/astropy_favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
  <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <script type="text/javascript">
    jQuery(function() { Search.loadIndex("../searchindex.js"); });
  </script>
  
  <script type="text/javascript" id="searchindexloader"></script>
   

  </head><body>


<nav class="navbar navbar-expand-lg bg-navbar">
  <a class="navbar-brand" href="/" style="padding: 0px 5px;">
    <img src="../../_static/astropy_logo.png" onerror="this.onerror=null;this.src='../_static/astropy_logo.png';" style="height: 38px;">
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarColor01" aria-controls="navbarColor01" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarColor01">
    <ul class="navbar-nav ml-auto">
      <li class="nav-item active">
        <a class="nav-link" href="http://www.astropy.org"/>Astropy<span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">Modules</a>
      </li>
    </ul>
    <form class="form-inline my-2 my-lg-0" action="../search.html" method="get">
      <div class="input-group-prepend">
          <button class="input-group-text" style="padding: 0.7rem"><i class="fa fa-search fa-fw"></i></button>
      </div>
      <input class="form-control mr-sm-3" name="q" type="text" placeholder="Search the universe" />
    </form>
  </div>
</nav>


<div class="container">
  <div class="row">

    
    
    

    
    <div class="col-md-3">
      <div id="sidebar" class="bs-sidenav card" role="complementary">
        <h3>Table of contents</h3>
        <ul>
<li><a class="reference internal" href="#">Modeling 1: Make a quick fit using astropy.modeling</a><ul>
<li><a class="reference internal" href="#authors">Authors</a></li>
<li><a class="reference internal" href="#learning-goals">Learning Goals</a></li>
<li><a class="reference internal" href="#keywords">Keywords</a></li>
<li><a class="reference internal" href="#summary">Summary</a><ul>
<li><a class="reference internal" href="#imports">Imports</a></li>
</ul>
</li>
<li><a class="reference internal" href="#fit-a-linear-model-three-steps-to-fit-data-using-astropy-modeling">1) Fit a Linear model: Three steps to fit data using astropy.modeling</a><ul>
<li><a class="reference internal" href="#models-in-astropy">Models in Astropy</a></li>
<li><a class="reference internal" href="#fitters-in-astropy">Fitters in Astropy</a><ul>
<li><a class="reference internal" href="#step-1-model">Step 1: Model</a></li>
<li><a class="reference internal" href="#step-2-fitter">Step 2: Fitter</a></li>
<li><a class="reference internal" href="#step-3-fit-data">Step 3: Fit Data</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#exercise">Exercise</a></li>
<li><a class="reference internal" href="#fit-a-polynomial-model-choose-fitter-wisely">2) Fit a Polynomial model: Choose fitter wisely</a></li>
<li><a class="reference internal" href="#fit-a-gaussian-lets-compare-to-scipy">3) Fit a Gaussian: Let’s compare to scipy</a></li>
<li><a class="reference internal" href="#id1">Summary:</a></li>
<li><a class="reference internal" href="#exercise-your-turn-to-choose">4) Exercise: Your turn to choose</a></li>
</ul>
</li>
</ul>

      </div>
    </div>
    

    <div class="col-md-9">
      <div class="content-padding card">
        <div>
  <a href="../_static/Models-Quick-Fit/Models-Quick-Fit.ipynb"><button id="download">Download tutorial notebook</button></a>
<a href="https://beta.mybinder.org/v2/gh/astropy/astropy-tutorials/master?filepath=/tutorials/notebooks/Models-Quick-Fit/Models-Quick-Fit.ipynb"><button id="binder">Interactive tutorial notebook</button></a>

<div id="spacer"></div><div class="section" id="modeling-1-make-a-quick-fit-using-astropy-modeling">
<span id="models-quick-fit"></span><h1>Modeling 1: Make a quick fit using astropy.modeling<a class="headerlink" href="#modeling-1-make-a-quick-fit-using-astropy-modeling" title="Permalink to this headline">¶</a></h1>
<div class="section" id="authors">
<h2>Authors<a class="headerlink" href="#authors" title="Permalink to this headline">¶</a></h2>
<p>Rocio Kiman, Lia Corrales, Zé Vinícius, Kelle Cruz, Stephanie T. Douglas</p>
</div>
<div class="section" id="learning-goals">
<h2>Learning Goals<a class="headerlink" href="#learning-goals" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Use <code class="docutils literal notranslate"><span class="pre">astroquery</span></code> to download data from Vizier</p></li>
<li><p>Use basic models in <code class="docutils literal notranslate"><span class="pre">astropy.modeling</span></code></p></li>
<li><p>Learn common functions to fit</p></li>
<li><p>Generate a quick fit to data</p></li>
<li><p>Plot the model with the data</p></li>
<li><p>Compare different models and fitters</p></li>
</ul>
</div>
<div class="section" id="keywords">
<h2>Keywords<a class="headerlink" href="#keywords" title="Permalink to this headline">¶</a></h2>
<p>modeling, model fitting, astrostatistics, astroquery, Vizier, scipy,
matplotlib, error bars, scatter plots</p>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>In this tutorial, we will become familiar with the models available in
<a class="reference external" href="http://docs.astropy.org/en/stable/modeling/">astropy.modeling</a> and
learn how to make a quick fit to our data.</p>
<div class="section" id="imports">
<h3>Imports<a class="headerlink" href="#imports" title="Permalink to this headline">¶</a></h3>
<p><span class="inputnumrole">In[1]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">astropy.modeling</span> <span class="kn">import</span> <span class="n">models</span><span class="p">,</span> <span class="n">fitting</span>
<span class="kn">from</span> <span class="nn">astroquery.vizier</span> <span class="kn">import</span> <span class="n">Vizier</span>
<span class="kn">import</span> <span class="nn">scipy.optimize</span>
<span class="c1"># Make plots display in notebooks</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="fit-a-linear-model-three-steps-to-fit-data-using-astropy-modeling">
<h2>1) Fit a Linear model: Three steps to fit data using astropy.modeling<a class="headerlink" href="#fit-a-linear-model-three-steps-to-fit-data-using-astropy-modeling" title="Permalink to this headline">¶</a></h2>
<p>We are going to start with a <strong>linear fit to real data</strong>. The data comes
from the paper <a class="reference external" href="https://ui.adsabs.harvard.edu/?#abs/2017A%26A...605A.100B">Bhardwaj et
al. 2017</a>.
This is a catalog of <strong>Type II Cepheids</strong>, which is a type of <strong>variable
stars</strong> that pulsate with a period between 1 and 50 days. In this part
of the tutorial, we are going to measure the <strong>Cepheids
Period-Luminosity</strong> relation using <code class="docutils literal notranslate"><span class="pre">astropy.modeling</span></code>. This relation
states that if a star has a longer period, the luminosity we measure is
higher.</p>
<p>To get it, we are going to import it from
<a class="reference external" href="http://vizier.u-strasbg.fr/viz-bin/VizieR">Vizier</a> using
<a class="reference external" href="http://astroquery.readthedocs.io/en/latest/vizier/vizier.html">astroquery</a>.</p>
<p><span class="inputnumrole">In[2]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">catalog</span> <span class="o">=</span> <span class="n">Vizier</span><span class="o">.</span><span class="n">get_catalogs</span><span class="p">(</span><span class="s1">&#39;J/A+A/605/A100&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This catalog has a lot of information, but for this tutorial we are
going to work only with periods and magnitudes. Let’s grab them using
the keywords <code class="docutils literal notranslate"><span class="pre">'Period'</span></code> and <code class="docutils literal notranslate"><span class="pre">__Ksmag__</span></code>. Note that <code class="docutils literal notranslate"><span class="pre">'e__Ksmag_'</span></code>
refers to the error bars in the magnitude measurements.</p>
<p><span class="inputnumrole">In[3]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">period</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">catalog</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;Period&#39;</span><span class="p">])</span>
<span class="n">log_period</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">period</span><span class="p">)</span>
<span class="n">k_mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">catalog</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;__Ksmag_&#39;</span><span class="p">])</span>
<span class="n">k_mag_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">catalog</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;e__Ksmag_&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Let’s take a look at the magnitude measurements as a function of period:</p>
<p><span class="inputnumrole">In[4]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">log_period</span><span class="p">,</span> <span class="n">k_mag</span><span class="p">,</span> <span class="n">k_mag_err</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;k.&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\log_</span><span class="si">{10}</span><span class="s1">$(Period [days])&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Ks&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><span class="outputnumrole">Out[4]:</span></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;Ks&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/Models-Quick-Fit_9_1.png" src="../_images/Models-Quick-Fit_9_1.png" />
<p>One could say that there is a linear relationship between log period and
magnitudes. To probe it, we want to make a fit to the data. This is
where <code class="docutils literal notranslate"><span class="pre">astropy.modeling</span></code> is useful. We are going to understand how in
three simple lines we can make any fit we want. We are going to start
with the linear fit, but first, let’s understand what a model and a
fitter are.</p>
<div class="section" id="models-in-astropy">
<h3>Models in Astropy<a class="headerlink" href="#models-in-astropy" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="http://docs.astropy.org/en/stable/modeling/#using-models">Models</a> in
Astropy are known parametrized functions. With this format they are easy
to define and to use, given that we do not need to write the function
expression every time we want to use a model, just the name. They can be
linear or non-linear in the variables. Some examples of models are:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://docs.astropy.org/en/stable/api/astropy.modeling.functional_models.Gaussian1D.html#astropy.modeling.functional_models.Gaussian1D">Gaussian1D</a></p></li>
<li><p><a class="reference external" href="http://docs.astropy.org/en/stable/api/astropy.modeling.functional_models.Trapezoid1D.html#astropy.modeling.functional_models.Trapezoid1D">Trapezoid1D</a></p></li>
<li><p><a class="reference external" href="http://docs.astropy.org/en/stable/api/astropy.modeling.polynomial.Polynomial1D.html#astropy.modeling.polynomial.Polynomial1D">Polynomial1D</a></p></li>
<li><p><a class="reference external" href="http://docs.astropy.org/en/stable/api/astropy.modeling.functional_models.Sine1D.html#astropy.modeling.functional_models.Sine1D">Sine1D</a></p></li>
<li><p><a class="reference external" href="http://docs.astropy.org/en/stable/api/astropy.modeling.functional_models.Linear1D.html#astropy.modeling.functional_models.Linear1D">Linear1D</a></p></li>
<li><p>The
<a class="reference external" href="http://docs.astropy.org/en/stable/modeling/#module-astropy.modeling.functional_models">list</a>
continues.</p></li>
</ul>
</div>
<div class="section" id="fitters-in-astropy">
<h3>Fitters in Astropy<a class="headerlink" href="#fitters-in-astropy" title="Permalink to this headline">¶</a></h3>
<p>Fitters in Astropy are the classes resposable for making the fit. They
can be linear or non-linear in the parameters (no the variable, like
models). Some examples are:</p>
<ul class="simple">
<li><p><a class="reference external" href="http://docs.astropy.org/en/stable/api/astropy.modeling.fitting.LevMarLSQFitter.html#astropy.modeling.fitting.LevMarLSQFitter">LevMarLSQFitter()</a>
Levenberg-Marquardt algorithm and least squares statistic.</p></li>
<li><p><a class="reference external" href="http://docs.astropy.org/en/stable/api/astropy.modeling.fitting.LinearLSQFitter.html#astropy.modeling.fitting.LinearLSQFitter">LinearLSQFitter()</a>
A class performing a linear least square fitting.</p></li>
<li><p><a class="reference external" href="http://docs.astropy.org/en/stable/api/astropy.modeling.fitting.SLSQPLSQFitter.html#astropy.modeling.fitting.SLSQPLSQFitter">SLSQPLSQFitter()</a>
SLSQP optimization algorithm and least squares statistic.</p></li>
<li><p><a class="reference external" href="http://docs.astropy.org/en/stable/api/astropy.modeling.fitting.SimplexLSQFitter.html#astropy.modeling.fitting.SimplexLSQFitter">SimplexLSQFitter()</a>
Simplex algorithm and least squares statistic.</p></li>
<li><p>More detailles
<a class="reference external" href="http://docs.astropy.org/en/stable/modeling/#id21">here</a></p></li>
</ul>
<p>Now we continue with our fitting.</p>
<div class="section" id="step-1-model">
<h4>Step 1: Model<a class="headerlink" href="#step-1-model" title="Permalink to this headline">¶</a></h4>
<p>First we need to choose which model we are going to use to fit to our
data. As we said before, our data looks like a linear relation, so we
are going to use a linear model.</p>
<p><span class="inputnumrole">In[5]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Linear1D</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="step-2-fitter">
<h4>Step 2: Fitter<a class="headerlink" href="#step-2-fitter" title="Permalink to this headline">¶</a></h4>
<p>Second we are going to choose the fitter we want to use. This choice is
basically which method we want to use to fit the model to the data. In
this case we are going to use the <a class="reference external" href="https://www.mathworks.com/help/curvefit/least-squares-fitting.html">Linear Least Square
Fitting</a>.
In the next exercise (<a class="reference external" href="http://learn.astropy.org/rst-tutorials/User-Defined-Model.html">Modeling 2: Create a User Defined
Model</a>)
we are going to analyze how to choose the fitter.</p>
<p><span class="inputnumrole">In[6]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fitter</span> <span class="o">=</span> <span class="n">fitting</span><span class="o">.</span><span class="n">LinearLSQFitter</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="step-3-fit-data">
<h4>Step 3: Fit Data<a class="headerlink" href="#step-3-fit-data" title="Permalink to this headline">¶</a></h4>
<p>Finally, we give to our <strong>fitter</strong> (method to fit the data) the
<strong>model</strong> and the <strong>data</strong> to perform the fit. Note that we are
including weights: This means that values with higher error will have
smaller weight (less importance) in the fit, and the contrary for data
with smaller errors. This way of fitting is called <em>Weighted Linear
Least Squares</em> and you can find more information about it
<a class="reference external" href="https://www.mathworks.com/help/curvefit/least-squares-fitting.html">here</a>
or
<a class="reference external" href="https://en.wikipedia.org/wiki/Least_squares#Weighted_least_squares">here</a>.</p>
<p><span class="inputnumrole">In[7]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">best_fit</span> <span class="o">=</span> <span class="n">fitter</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">log_period</span><span class="p">,</span> <span class="n">k_mag</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="mf">1.0</span><span class="o">/</span><span class="n">k_mag_err</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">best_fit</span><span class="p">)</span>
</pre></div>
</div>
<p><span class="outputnumrole">Out[7]:</span></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Model</span><span class="p">:</span> <span class="n">Linear1D</span>
<span class="n">Inputs</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,)</span>
<span class="n">Outputs</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,)</span>
<span class="n">Model</span> <span class="nb">set</span> <span class="n">size</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">Parameters</span><span class="p">:</span>
          <span class="n">slope</span>           <span class="n">intercept</span>
    <span class="o">------------------</span> <span class="o">----------------</span>
    <span class="o">-</span><span class="mf">2.098140247252651</span> <span class="mf">13.4183588488101</span>
</pre></div>
</div>
<p>And that’s it!</p>
<p>We can evaluate the fit at our particular x axis by doing
<code class="docutils literal notranslate"><span class="pre">best_fit(x)</span></code>.</p>
<p><span class="inputnumrole">In[8]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">log_period</span><span class="p">,</span><span class="n">k_mag</span><span class="p">,</span><span class="n">k_mag_err</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;k.&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">log_period</span><span class="p">,</span> <span class="n">best_fit</span><span class="p">(</span><span class="n">log_period</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\log_</span><span class="si">{10}</span><span class="s1">$(Period [days])&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Ks&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><span class="outputnumrole">Out[8]:</span></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;Ks&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/Models-Quick-Fit_26_1.png" src="../_images/Models-Quick-Fit_26_1.png" />
<p><strong>Conclusion:</strong> Remember, you can fit data with three lines of code:</p>
<ol class="arabic simple">
<li><p>Choose a
<a class="reference external" href="http://docs.astropy.org/en/stable/modeling/#module-astropy.modeling.functional_models">model</a>.</p></li>
<li><p>Choose a
<a class="reference external" href="http://docs.astropy.org/en/stable/modeling/#id21">fitter</a>.</p></li>
<li><p>Pass to the fitter the model and the data to perform fit.</p></li>
</ol>
</div>
</div>
</div>
<div class="section" id="exercise">
<h2>Exercise<a class="headerlink" href="#exercise" title="Permalink to this headline">¶</a></h2>
<p>Use the model <code class="docutils literal notranslate"><span class="pre">Polynomial1D(degree=1)</span></code> to fit the same data and
compare the results.</p>
<p><span class="inputnumrole">In[None]:</span></p>
</div>
<div class="section" id="fit-a-polynomial-model-choose-fitter-wisely">
<h2>2) Fit a Polynomial model: Choose fitter wisely<a class="headerlink" href="#fit-a-polynomial-model-choose-fitter-wisely" title="Permalink to this headline">¶</a></h2>
<p>For our second example, let’s fit a polynomial of degree more than 1. In
this case, we are going to create fake data to make the fit. Note that
we’re adding gaussian noise to the data with the function
<code class="docutils literal notranslate"><span class="pre">np.random.normal(0,2)</span></code> which gives a random number from a gaussian
distribution with mean 0 and standard deviation 2.</p>
<p><span class="inputnumrole">In[9]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>  <span class="c1"># Makes an array from 0 to 4 of N elements</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">x1</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="mi">6</span><span class="o">*</span><span class="n">x1</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">12</span><span class="o">*</span><span class="n">x1</span> <span class="o">-</span> <span class="mi">9</span>
<span class="c1"># Now we add some noise to the data</span>
<span class="n">y1</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">y1</span><span class="p">))</span> <span class="c1">#One way to add random gaussian noise</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">y1_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">sigma</span>
</pre></div>
</div>
<p>Let’s plot it to see how it looks:</p>
<p><span class="inputnumrole">In[10]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">y1_err</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;k.&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$x_1$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$y_1$&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><span class="outputnumrole">Out[10]:</span></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;$y_1$&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/Models-Quick-Fit_35_1.png" src="../_images/Models-Quick-Fit_35_1.png" />
<p>To fit this data let’s remember the three steps: model, fitter and
perform fit.</p>
<p><span class="inputnumrole">In[11]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model_poly</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Polynomial1D</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">fitter_poly</span> <span class="o">=</span> <span class="n">fitting</span><span class="o">.</span><span class="n">LinearLSQFitter</span><span class="p">()</span>
<span class="n">best_fit_poly</span> <span class="o">=</span> <span class="n">fitter_poly</span><span class="p">(</span><span class="n">model_poly</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">y1_err</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p><span class="inputnumrole">In[12]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">best_fit_poly</span><span class="p">)</span>
</pre></div>
</div>
<p><span class="outputnumrole">Out[12]:</span></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Model</span><span class="p">:</span> <span class="n">Polynomial1D</span>
<span class="n">Inputs</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,)</span>
<span class="n">Outputs</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,)</span>
<span class="n">Model</span> <span class="nb">set</span> <span class="n">size</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">Degree</span><span class="p">:</span> <span class="mi">3</span>
<span class="n">Parameters</span><span class="p">:</span>
            <span class="n">c0</span>                 <span class="n">c1</span>                 <span class="n">c2</span>                 <span class="n">c3</span>
    <span class="o">------------------</span> <span class="o">------------------</span> <span class="o">------------------</span> <span class="o">------------------</span>
    <span class="o">-</span><span class="mf">9.244495207968157</span> <span class="mf">12.440669253501762</span> <span class="o">-</span><span class="mf">5.908792300917658</span> <span class="mf">0.9314523435375572</span>
</pre></div>
</div>
<p>What would happend if we use a different fitter (method)? Let’s use the
same model but with <code class="docutils literal notranslate"><span class="pre">SimplexLSQFitter</span></code> as fitter.</p>
<p><span class="inputnumrole">In[13]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">fitter_poly_2</span> <span class="o">=</span> <span class="n">fitting</span><span class="o">.</span><span class="n">SimplexLSQFitter</span><span class="p">()</span>
<span class="n">best_fit_poly_2</span> <span class="o">=</span> <span class="n">fitter_poly_2</span><span class="p">(</span><span class="n">model_poly</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">weights</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">y1_err</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p><span class="outputnumrole">Out[13]:</span></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">WARNING</span><span class="p">:</span> <span class="n">Model</span> <span class="ow">is</span> <span class="n">linear</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">;</span> <span class="n">consider</span> <span class="n">using</span> <span class="n">linear</span> <span class="n">fitting</span> <span class="n">methods</span><span class="o">.</span> <span class="p">[</span><span class="n">astropy</span><span class="o">.</span><span class="n">modeling</span><span class="o">.</span><span class="n">fitting</span><span class="p">]</span>
<span class="n">WARNING</span><span class="p">:</span> <span class="n">The</span> <span class="n">fit</span> <span class="n">may</span> <span class="n">be</span> <span class="n">unsuccessful</span><span class="p">;</span> <span class="n">Maximum</span> <span class="n">number</span> <span class="n">of</span> <span class="n">iterations</span> <span class="n">reached</span><span class="o">.</span> <span class="p">[</span><span class="n">astropy</span><span class="o">.</span><span class="n">modeling</span><span class="o">.</span><span class="n">optimizers</span><span class="p">]</span>
</pre></div>
</div>
<p><span class="inputnumrole">In[14]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">best_fit_poly_2</span><span class="p">)</span>
</pre></div>
</div>
<p><span class="outputnumrole">Out[14]:</span></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Model</span><span class="p">:</span> <span class="n">Polynomial1D</span>
<span class="n">Inputs</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,)</span>
<span class="n">Outputs</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,)</span>
<span class="n">Model</span> <span class="nb">set</span> <span class="n">size</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">Degree</span><span class="p">:</span> <span class="mi">3</span>
<span class="n">Parameters</span><span class="p">:</span>
             <span class="n">c0</span>                 <span class="n">c1</span>                 <span class="n">c2</span>                  <span class="n">c3</span>
    <span class="o">-------------------</span> <span class="o">------------------</span> <span class="o">------------------</span> <span class="o">--------------------</span>
    <span class="o">-</span><span class="mf">0.9879027616931679</span> <span class="o">-</span><span class="mf">3.009096607690824</span> <span class="mf">1.4444245522047934</span> <span class="o">-</span><span class="mf">0.08658512127819726</span>
</pre></div>
</div>
<p>Note that we got a warning after using <code class="docutils literal notranslate"><span class="pre">SimplexLSQFitter</span></code> to fit the
data. The first line says:</p>
<p><code class="docutils literal notranslate"><span class="pre">WARNING:</span> <span class="pre">Model</span> <span class="pre">is</span> <span class="pre">linear</span> <span class="pre">in</span> <span class="pre">parameters;</span> <span class="pre">consider</span> <span class="pre">using</span> <span class="pre">linear</span> <span class="pre">fitting</span> <span class="pre">methods.</span> <span class="pre">[astropy.modeling.fitting]</span></code></p>
<p>If we look at the model we chose:
<span class="math notranslate nohighlight">\(y = c_0 + c_1\times x + c_2\times x^2 + c_3\times x^3\)</span>, it is
linear in the parameters <span class="math notranslate nohighlight">\(c_i\)</span>. The warning means that
<code class="docutils literal notranslate"><span class="pre">SimplexLSQFitter</span></code> works better with models that are not linear in the
parameters, and that we should use a linear fitter like
<code class="docutils literal notranslate"><span class="pre">LinearLSQFitter</span></code>. The second line says:</p>
<p><code class="docutils literal notranslate"><span class="pre">WARNING:</span> <span class="pre">The</span> <span class="pre">fit</span> <span class="pre">may</span> <span class="pre">be</span> <span class="pre">unsuccessful;</span> <span class="pre">Maximum</span> <span class="pre">number</span> <span class="pre">of</span> <span class="pre">iterations</span> <span class="pre">reached.</span> <span class="pre">[astropy.modeling.optimizers]</span></code></p>
<p>So it’s not surprising that the results are different, because this
means that the fitter is not working properly. Let’s discuss a method of
choosing between fits and remember to <strong>pay attention</strong> when you choose
the <strong>fitter</strong>.</p>
<p>One way to check which model parameters are a better fit is calculating
the <a class="reference external" href="https://en.wikipedia.org/wiki/Reduced_chi-squared_statistic">Reduced Chi Square
Value</a>.
Let’s define a function to do that because we’re going to use it several
times.</p>
<p><span class="inputnumrole">In[15]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">calc_reduced_chi_square</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">yerr</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">n_free</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    fit (array) values for the fit</span>
<span class="sd">    x,y,yerr (arrays) data</span>
<span class="sd">    N total number of points</span>
<span class="sd">    n_free number of parameters we are fitting</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="mf">1.0</span><span class="o">/</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="n">n_free</span><span class="p">)</span><span class="o">*</span><span class="nb">sum</span><span class="p">(((</span><span class="n">fit</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span><span class="o">/</span><span class="n">yerr</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p><span class="inputnumrole">In[16]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">reduced_chi_squared</span> <span class="o">=</span> <span class="n">calc_reduced_chi_square</span><span class="p">(</span><span class="n">best_fit_poly</span><span class="p">(</span><span class="n">x1</span><span class="p">),</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y1_err</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reduced Chi Squared with LinearLSQFitter: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reduced_chi_squared</span><span class="p">))</span>
</pre></div>
</div>
<p><span class="outputnumrole">Out[16]:</span></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Reduced</span> <span class="n">Chi</span> <span class="n">Squared</span> <span class="k">with</span> <span class="n">LinearLSQFitter</span><span class="p">:</span> <span class="mf">1.9788773841149765</span>
</pre></div>
</div>
<p><span class="inputnumrole">In[17]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">reduced_chi_squared</span> <span class="o">=</span> <span class="n">calc_reduced_chi_square</span><span class="p">(</span><span class="n">best_fit_poly_2</span><span class="p">(</span><span class="n">x1</span><span class="p">),</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y1_err</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reduced Chi Squared with SimplexLSQFitter: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reduced_chi_squared</span><span class="p">))</span>
</pre></div>
</div>
<p><span class="outputnumrole">Out[17]:</span></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Reduced</span> <span class="n">Chi</span> <span class="n">Squared</span> <span class="k">with</span> <span class="n">SimplexLSQFitter</span><span class="p">:</span> <span class="mf">4.182586300823317</span>
</pre></div>
</div>
<p>As we can see, the <em>Reduced Chi Square</em> for the first fit is closer to
one, which means this fit is better. Note that this is what we expected
after the discussion of the warnings.</p>
<p>We can also compare the two fits visually:</p>
<p><span class="inputnumrole">In[18]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">y1_err</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;k.&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">best_fit_poly</span><span class="p">(</span><span class="n">x1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;LinearLSQFitter()&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">best_fit_poly_2</span><span class="p">(</span><span class="n">x1</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;SimplexLSQFitter()&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\log_</span><span class="si">{10}</span><span class="s1">$(Period [days])&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Ks&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
<p><span class="outputnumrole">Out[18]:</span></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">Legend</span> <span class="n">at</span> <span class="mh">0x7f1b7039f8d0</span><span class="o">&gt;</span>
</pre></div>
</div>
<img alt="../_images/Models-Quick-Fit_49_1.png" src="../_images/Models-Quick-Fit_49_1.png" />
<p>Results are as espected, the fit performed with the linear fitter is
better than the second, non linear one.</p>
<p><strong>Conclusion:</strong> Pay attention when you choose the fitter.</p>
</div>
<div class="section" id="fit-a-gaussian-lets-compare-to-scipy">
<h2>3) Fit a Gaussian: Let’s compare to scipy<a class="headerlink" href="#fit-a-gaussian-lets-compare-to-scipy" title="Permalink to this headline">¶</a></h2>
<p>Scipy has the function
<a class="reference external" href="https://docs.scipy.org/doc/scipy-1.0.0/reference/generated/scipy.optimize.curve_fit.html">scipy.optimize.curve_fit</a>
to fit in a similar way that we are doing. Let’s compare the two methods
with fake data in the shape of a Gaussian.</p>
<p><span class="inputnumrole">In[19]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">amplitude</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="mf">10.0</span>
<span class="n">N2</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="n">y2</span> <span class="o">=</span> <span class="n">amplitude</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x2</span><span class="o">-</span><span class="n">mu</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="n">y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">y_point</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">y_point</span> <span class="ow">in</span> <span class="n">y2</span><span class="p">])</span>   <span class="c1">#Another way to add random gaussian noise</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">y2_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">sigma</span>
</pre></div>
</div>
<p><span class="inputnumrole">In[20]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">y2_err</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;k.&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$x_2$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$y_2$&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><span class="outputnumrole">Out[20]:</span></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;$y_2$&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/Models-Quick-Fit_54_1.png" src="../_images/Models-Quick-Fit_54_1.png" />
<p>Let’s do our three steps to make the fit we want. For this fit we’re
going to use a non-linear fitter, <code class="docutils literal notranslate"><span class="pre">LevMarLSQFitter</span></code>, because the model
we need (<code class="docutils literal notranslate"><span class="pre">Gaussian1D</span></code>) is non-linear in the parameters.</p>
<p><span class="inputnumrole">In[21]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model_gauss</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Gaussian1D</span><span class="p">()</span>
<span class="n">fitter_gauss</span> <span class="o">=</span> <span class="n">fitting</span><span class="o">.</span><span class="n">LevMarLSQFitter</span><span class="p">()</span>
<span class="n">best_fit_gauss</span> <span class="o">=</span> <span class="n">fitter_gauss</span><span class="p">(</span><span class="n">model_gauss</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="n">y2_err</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p><span class="inputnumrole">In[22]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">best_fit_gauss</span><span class="p">)</span>
</pre></div>
</div>
<p><span class="outputnumrole">Out[22]:</span></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Model</span><span class="p">:</span> <span class="n">Gaussian1D</span>
<span class="n">Inputs</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,)</span>
<span class="n">Outputs</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,)</span>
<span class="n">Model</span> <span class="nb">set</span> <span class="n">size</span><span class="p">:</span> <span class="mi">1</span>
<span class="n">Parameters</span><span class="p">:</span>
        <span class="n">amplitude</span>              <span class="n">mean</span>               <span class="n">stddev</span>
    <span class="o">-----------------</span> <span class="o">---------------------</span> <span class="o">------------------</span>
    <span class="mf">9.881427525757596</span> <span class="o">-</span><span class="mf">0.013964906837023375</span> <span class="mf">10.207540564685125</span>
</pre></div>
</div>
<p>We can get the <a class="reference external" href="http://mathworld.wolfram.com/CovarianceMatrix.html">covariance
matrix</a> from
<code class="docutils literal notranslate"><span class="pre">LevMarLSQFitter</span></code>, which provides an error for our fit parameters by
doing <code class="docutils literal notranslate"><span class="pre">fitter.fit_info['param_cov']</span></code>. The elements in the diagonal of
this matrix are the square of the errors. We can check the order of the
parameters using:</p>
<p><span class="inputnumrole">In[23]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model_gauss</span><span class="o">.</span><span class="n">param_names</span>
</pre></div>
</div>
<p><span class="outputnumrole">Out[23]:</span></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s1">&#39;amplitude&#39;</span><span class="p">,</span> <span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;stddev&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><span class="inputnumrole">In[24]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cov_diag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">fitter_gauss</span><span class="o">.</span><span class="n">fit_info</span><span class="p">[</span><span class="s1">&#39;param_cov&#39;</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cov_diag</span><span class="p">)</span>
</pre></div>
</div>
<p><span class="outputnumrole">Out[24]:</span></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="mf">0.05453435</span> <span class="mf">0.07753532</span> <span class="mf">0.07785704</span><span class="p">]</span>
</pre></div>
</div>
<p>Then:</p>
<p><span class="inputnumrole">In[25]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Amplitude: </span><span class="si">{}</span><span class="s1"> +\- </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">best_fit_gauss</span><span class="o">.</span><span class="n">amplitude</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cov_diag</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean: </span><span class="si">{}</span><span class="s1"> +\- </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">best_fit_gauss</span><span class="o">.</span><span class="n">mean</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cov_diag</span><span class="p">[</span><span class="mi">1</span><span class="p">])))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Standard Deviation: </span><span class="si">{}</span><span class="s1"> +\- </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">best_fit_gauss</span><span class="o">.</span><span class="n">stddev</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">cov_diag</span><span class="p">[</span><span class="mi">2</span><span class="p">])))</span>
</pre></div>
</div>
<p><span class="outputnumrole">Out[25]:</span></p>
<pre class="literal-block">Amplitude: 9.881427525757596 +- 0.23352589801806148
Mean: -0.013964906837023375 +- 0.27845165237794184
Standard Deviation: 10.207540564685125 +- 0.2790287392602458</pre>
<p>We can apply the same method with <code class="docutils literal notranslate"><span class="pre">scipy.optimize.curve_fit</span></code>, and
compare the results using again the <em>Reduced Chi Square Value</em>.</p>
<p><span class="inputnumrole">In[26]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">a</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">b</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">c</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
<p><span class="inputnumrole">In[27]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">p_opt</span><span class="p">,</span> <span class="n">p_cov</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">curve_fit</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">y1_err</span><span class="p">)</span>
<span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span> <span class="o">=</span> <span class="n">p_opt</span>
<span class="n">best_fit_gauss_2</span> <span class="o">=</span> <span class="n">f</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
<p><span class="inputnumrole">In[28]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">p_opt</span><span class="p">)</span>
</pre></div>
</div>
<p><span class="outputnumrole">Out[28]:</span></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span> <span class="mf">9.88142788</span> <span class="o">-</span><span class="mf">0.01396849</span> <span class="mf">10.20753984</span><span class="p">]</span>
</pre></div>
</div>
<p><span class="inputnumrole">In[29]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Amplitude: </span><span class="si">{}</span><span class="s1"> +\- </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p_opt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p_cov</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Mean: </span><span class="si">{}</span><span class="s1"> +\- </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p_opt</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p_cov</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Standard Deviation: </span><span class="si">{}</span><span class="s1"> +\- </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p_opt</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p_cov</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">])))</span>
</pre></div>
</div>
<p><span class="outputnumrole">Out[29]:</span></p>
<pre class="literal-block">Amplitude: 9.881427877063164 +- 0.2335260362766198
Mean: -0.013968494028724944 +- 0.2784519008807276
Standard Deviation: 10.207539841322097 +- 0.2790283900875054</pre>
<p><span class="inputnumrole">In[30]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">reduced_chi_squared</span> <span class="o">=</span> <span class="n">calc_reduced_chi_square</span><span class="p">(</span><span class="n">best_fit_gauss</span><span class="p">(</span><span class="n">x2</span><span class="p">),</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">y2_err</span><span class="p">,</span> <span class="n">N2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reduced Chi Squared using astropy.modeling: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reduced_chi_squared</span><span class="p">))</span>
</pre></div>
</div>
<p><span class="outputnumrole">Out[30]:</span></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Reduced</span> <span class="n">Chi</span> <span class="n">Squared</span> <span class="n">using</span> <span class="n">astropy</span><span class="o">.</span><span class="n">modeling</span><span class="p">:</span> <span class="mf">1.0839748308859336</span>
</pre></div>
</div>
<p><span class="inputnumrole">In[31]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">reduced_chi_squared</span> <span class="o">=</span> <span class="n">calc_reduced_chi_square</span><span class="p">(</span><span class="n">best_fit_gauss_2</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">y2_err</span><span class="p">,</span> <span class="n">N2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Reduced Chi Squared using scipy: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">reduced_chi_squared</span><span class="p">))</span>
</pre></div>
</div>
<p><span class="outputnumrole">Out[31]:</span></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Reduced</span> <span class="n">Chi</span> <span class="n">Squared</span> <span class="n">using</span> <span class="n">scipy</span><span class="p">:</span> <span class="mf">1.0839748308874755</span>
</pre></div>
</div>
<p>As we can see there is a very small difference in the <em>Reduced Chi
Squared</em>. This actually needed to happen, because the fitter in
<code class="docutils literal notranslate"><span class="pre">astropy.modeling</span></code> uses scipy to fit. The advantage of using
<code class="docutils literal notranslate"><span class="pre">astropy.modeling</span></code> is you only need to change the name of the fitter
and the model to perform a completely different fit, while scipy require
us to remember the expression of the function we wanted to use.</p>
<p><span class="inputnumrole">In[32]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">y2_err</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;k.&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">best_fit_gauss</span><span class="p">(</span><span class="n">x2</span><span class="p">),</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;astropy.modeling&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">best_fit_gauss_2</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;scipy&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$x_2$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$y_2$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
<p><span class="outputnumrole">Out[32]:</span></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">matplotlib</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">Legend</span> <span class="n">at</span> <span class="mh">0x7f1b701e1210</span><span class="o">&gt;</span>
</pre></div>
</div>
<img alt="../_images/Models-Quick-Fit_72_1.png" src="../_images/Models-Quick-Fit_72_1.png" />
<p><strong>Conclusion:</strong> Choose the method most convenient for every case you
need to fit. We recomend <code class="docutils literal notranslate"><span class="pre">astropy.modeling</span></code> because is easier to write
the name of the function you want to fit than to remember the expression
every time we want to use it. Also, <code class="docutils literal notranslate"><span class="pre">astropy.modeling</span></code> becomes useful
with more complicated models like <a class="reference external" href="http://docs.astropy.org/en/stable/modeling/#compound-models">two
gaussians</a>
plus a <a class="reference external" href="http://docs.astropy.org/en/stable/modeling/#blackbody-radiation">black
body</a>,
but that is another tutorial.</p>
</div>
<div class="section" id="id1">
<h2>Summary:<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Let’s review the conclusion we got in this tutorial:</p>
<ol class="arabic simple">
<li><p>You can fit data with <strong>three lines of code</strong>:</p>
<ul class="simple">
<li><p>model</p></li>
<li><p>fitter</p></li>
<li><p>perform fit to data</p></li>
</ul>
</li>
<li><p><strong>Pay attention</strong> when you choose the <strong>fitter</strong>.</p></li>
<li><p>Choose the method most convenient for every case you need to fit. We
recomend <code class="docutils literal notranslate"><span class="pre">astropy.modeling</span></code> to make <strong>quick fits of known
functions</strong>.</p></li>
</ol>
</div>
<div class="section" id="exercise-your-turn-to-choose">
<h2>4) Exercise: Your turn to choose<a class="headerlink" href="#exercise-your-turn-to-choose" title="Permalink to this headline">¶</a></h2>
<p>For the next data: * Choose model and fitter to fit this data *
Compare different options</p>
<p><span class="inputnumrole">In[33]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">N3</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">x3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">N3</span><span class="p">)</span>
<span class="n">y3</span> <span class="o">=</span> <span class="mf">5.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">x3</span><span class="p">)</span>
<span class="n">y3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">y_point</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">y_point</span> <span class="ow">in</span> <span class="n">y3</span><span class="p">])</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">y3_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">*</span><span class="n">sigma</span>
</pre></div>
</div>
<p><span class="inputnumrole">In[34]:</span></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">x3</span><span class="p">,</span> <span class="n">y3</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="n">y3_err</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;k.&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$x_3$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$y_3$&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><span class="outputnumrole">Out[34]:</span></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;$y_3$&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../_images/Models-Quick-Fit_78_1.png" src="../_images/Models-Quick-Fit_78_1.png" />
<p><span class="inputnumrole">In[None]:</span></p>
<div id="spacer"></div>

<a href="../_static/Models-Quick-Fit/Models-Quick-Fit.ipynb"><button id="download">Download tutorial notebook</button></a>
<a href="https://beta.mybinder.org/v2/gh/astropy/astropy-tutorials/master?filepath=/tutorials/notebooks/Models-Quick-Fit/Models-Quick-Fit.ipynb"><button id="binder">Interactive tutorial notebook</button></a></div>
</div>

</div>
      </div>
      
    </div>
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
    Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.4.4.
    &copy; Copyright Astropy.
    </p>
  </div>
</footer>
  </body>
</html>